# Data Model: Spec-3 — Frontend Application & System Integration

## Entity Definitions

### User Session Entity (Managed by Better Auth)
Represents the authenticated user session state in the frontend application.

**Fields:**
- `isAuthenticated`: Boolean
  - Purpose: Indicates whether the user is currently authenticated
  - Constraints: Required, true/false value
- `jwtToken`: String
  - Purpose: JWT token for API authentication
  - Constraints: Stored securely in browser storage, required when authenticated
- `userProfile`: Object
  - Purpose: Contains user profile information from auth provider
  - Constraints: Optional, may include email, name, etc.
- `isLoading`: Boolean
  - Purpose: Indicates whether authentication state is being checked
  - Constraints: Required, true during auth verification
- `error`: String
  - Purpose: Error message if authentication fails
  - Constraints: Optional, contains error details if present

**State Transitions:**
- `unauthenticated` → `loading`: When checking auth status
- `loading` → `authenticated`: When valid token is found
- `loading` → `unauthenticated`: When no valid token exists
- `authenticated` → `unauthenticated`: During logout or token expiration

### Task Entity (Consumed from Backend API)
Represents a task as received from the backend API and managed in the frontend state.

**Fields:**
- `id`: UUID (Primary Key)
  - Purpose: Unique identifier for the task
  - Constraints: Auto-generated by backend, immutable
- `title`: String
  - Purpose: Content/description of the task
  - Constraints: Required, max length from backend validation
- `completed`: Boolean
  - Purpose: Completion status of the task
  - Constraints: Default false, can be toggled by user
- `userId`: UUID
  - Purpose: Owner identifier from JWT (not displayed to user)
  - Constraints: Derived from JWT claims, not user-modifiable
- `createdAt`: DateTime
  - Purpose: Timestamp when task was created
  - Constraints: Auto-generated by backend, read-only
- `updatedAt`: DateTime
  - Purpose: Timestamp when task was last updated
  - Constraints: Auto-generated by backend, read-only

**Validation Rules:**
- Task title cannot be empty
- Task ownership verified by backend (frontend doesn't control)
- Task completion can only be changed by the owner (verified by backend)

### UI State Entity
Represents the application's UI state managed by React components and context.

**Fields:**
- `currentRoute`: String
  - Purpose: Currently active page/route
  - Constraints: Required, corresponds to App Router paths
- `taskList`: Array
  - Purpose: Collection of tasks currently displayed
  - Constraints: Array of Task objects, may be filtered
- `loadingStates`: Object
  - Purpose: Loading indicators for different operations
  - Constraints: Key-value pairs of operation status
- `errorStates`: Object
  - Purpose: Error messages for different operations
  - Constraints: Key-value pairs of error details
- `formStates`: Object
  - Purpose: Form input values and validation status
  - Constraints: Key-value pairs of form field data

**State Transitions:**
- `idle` → `loading`: When initiating API request
- `loading` → `success`: When API request succeeds
- `loading` → `error`: When API request fails
- `success` → `idle`: After successful operation completion

## State Transitions

### Authentication States
- **Unauthenticated State**: Initial state with no token
  - Transition: User signs in → Loading state
- **Loading State**: Checking authentication status
  - Transition: Token valid → Authenticated state
  - Transition: No token or invalid → Remain unauthenticated
- **Authenticated State**: Valid token exists
  - Transition: User signs out → Unauthenticated state
  - Transition: Token expires → Unauthenticated state

### Task Operation States
- **Idle State**: No active operations
  - Transition: User initiates operation → Loading state
- **Loading State**: API request in progress
  - Transition: Request succeeds → Success state
  - Transition: Request fails → Error state
- **Success State**: Operation completed successfully
  - Transition: Next operation → Idle state
- **Error State**: Operation failed
  - Transition: Retry → Loading state
  - Transition: Dismiss → Idle state

## Component State Dependencies

### Protected Route Component
- Depends on: User Session Entity (isAuthenticated, isLoading)
- Behavior: Redirects to sign-in if not authenticated
- Updates: None (reads authentication state only)

### Task List Component
- Depends on: Task Entity (collection), UI State Entity (taskList, loadingStates)
- Behavior: Displays tasks, handles loading/error states
- Updates: UI State Entity (taskList), Task Entity (via API)

### Task Form Component
- Depends on: UI State Entity (formStates, errorStates)
- Behavior: Captures user input, validates submission
- Updates: UI State Entity (formStates), Task Entity (via API)

### Authentication Components (Sign-in/Sign-up)
- Depends on: User Session Entity (error)
- Behavior: Handles user credentials, manages authentication flow
- Updates: User Session Entity (isAuthenticated, jwtToken)

## Data Flow Patterns

### Authentication Flow
1. App loads → Check for JWT token in storage
2. Token exists → Verify token validity
3. Valid token → Set isAuthenticated to true
4. No/invalid token → Set isAuthenticated to false
5. User performs auth action → Update session state

### Task Data Flow
1. User navigates to task page → Fetch tasks from API
2. API request initiated → Set loading state
3. API response received → Update task list
4. User modifies task → Send update to API
5. API confirms update → Refresh task list

### Error Handling Flow
1. API request fails → Capture error details
2. Set error state in UI
3. Display error to user
4. Provide option to retry or dismiss

## Performance Considerations

### Caching Strategies
- Cache authenticated user data in memory
- Implement smart refetching of task data
- Consider caching API responses where appropriate
- Clear caches on logout to ensure data freshness

### Loading State Management
- Show immediate feedback for all API operations
- Implement skeleton loading states for better UX
- Differentiate between initial load and subsequent updates
- Handle slow network conditions gracefully

### Memory Management
- Clean up component state on unmount
- Clear authentication data on logout
- Implement proper cleanup for event listeners
- Prevent memory leaks in asynchronous operations